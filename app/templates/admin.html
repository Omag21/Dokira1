<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Plateforme Santé</title>
    <link rel="stylesheet" href="/static/css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-user-md"></i>
                    <span>Dokira Pro</span>
                </div>
                <button class="toggle-sidebar" id="toggleSidebar">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#tableau-bord" class="nav-link active" data-section="tableau-bord">
                        <i class="fas fa-th-large"></i>
                        <span>Tableau de Bord</span>
                    </a></li>
                    <li><a href="#medecins-attente" class="nav-link" data-section="medecins-attente">
                        <i class="fas fa-hourglass-half"></i>
                        <span>Inscriptions Méd.</span>
                        <span class="badge" id="badge-attente">0</span>
                    </a></li>
                    <li><a href="#medecins-actifs" class="nav-link" data-section="medecins-actifs">
                        <i class="fas fa-user-md"></i>
                        <span>Médecins Actifs</span>
                    </a></li>
                    <li><a href="#tous-medecins" class="nav-link" data-section="tous-medecins">
                        <i class="fas fa-list"></i>
                        <span>Tous Médecins</span>
                    </a></li>
                    <li><a href="#patients" class="nav-link" data-section="patients">
                        <i class="fas fa-users"></i>
                        <span>Patients</span>
                    </a></li>
                    <li><a href="#ajouter-medecin" class="nav-link" data-section="ajouter-medecin">
                        <i class="fas fa-plus-circle"></i>
                        <span>Ajouter Médecin</span>
                    </a></li>
                    <li><a href="#annonces" class="nav-link" data-section="annonces">
                        <i class="fas fa-bullhorn"></i>
                        <span>Annonces</span>
                    </a></li>
                    <li><a href="#statistiques" class="nav-link" data-section="statistiques">
                        <i class="fas fa-chart-bar"></i>
                        <span>Statistiques</span>
                    </a></li>
                    <li><a href="#messagerie" class="nav-link" data-section="messagerie">
                        <i class="fas fa-envelope"></i>
                        <span>Messagerie</span>
                    </a></li>
                    <li><a href="#chat-ia" class="nav-link" data-section="chat-ia">
                        <i class="fas fa-robot"></i>
                        <span>Chat IA</span>
                    </a></li>
                    <li><a href="#parametres" class="nav-link" data-section="parametres">
                        <i class="fas fa-cog"></i>
                        <span>Paramètres</span>
                    </a></li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Déconnexion</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="top-bar">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Rechercher..." id="searchInput">
                </div>
                <div class="top-bar-right">
                    <button class="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-count">3</span>
                    </button>
                    <div class="admin-profile">
                        <img id="adminPhoto" src="https://via.placeholder.com/40" alt="Admin" class="profile-photo">
                        <span id="adminName">Admin</span>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <section class="content-area">
                <!-- Tableau de Bord -->
                <div id="tableau-bord" class="section active">
                    <h2>Tableau de Bord</h2>
                    <div class="dashboard-cards">
                        <div class="card">
                            <div class="card-icon" style="background: #3498db;">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <div class="card-content">
                                <h3>Médecins Actifs</h3>
                                <p class="card-number" id="cardActiveMedecins">0</p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-icon" style="background: #2ecc71;">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="card-content">
                                <h3>Patients</h3>
                                <p class="card-number" id="cardPatients">0</p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-icon" style="background: #f39c12;">
                                <i class="fas fa-hourglass-half"></i>
                            </div>
                            <div class="card-content">
                                <h3>En Attente</h3>
                                <p class="card-number" id="cardPending">0</p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-icon" style="background: #e74c3c;">
                                <i class="fas fa-euro-sign"></i>
                            </div>
                            <div class="card-content">
                                <h3>Revenus (Mois)</h3>
                                <p class="card-number" id="cardRevenue">0€</p>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="widget">
                            <h3>Activité Récente</h3>
                            <div class="activity-list" id="activityList">
                                <p class="empty-state">Aucune activité pour le moment</p>
                            </div>
                        </div>
                        <div class="widget">
                            <h3>Inscriptions en Attente</h3>
                            <div class="pending-list" id="pendingList">
                                <p class="empty-state">Aucune inscription en attente</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inscriptions Médecin en Attente -->
                <div id="medecins-attente" class="section">
                    <h2>Approuver les Inscriptions Médecin</h2>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Photo</th>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>Spécialité</th>
                                    <th>Téléphone</th>
                                    <th>Date Inscription</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pendingMedecinTable">
                                <tr><td colspan="7" class="empty-state">Aucun médecin en attente</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Médecins Actifs -->
                <div id="medecins-actifs" class="section">
                    <h2>Médecins Actifs (En Service)</h2>
                    <div class="filters">
                        <select id="filterSpeciality" class="filter-select">
                            <option value="">Toutes les spécialités</option>
                        </select>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Photo</th>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>Spécialité</th>
                                    <th>Prix/Consultation</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="activeMedecinTable">
                                <tr><td colspan="7" class="empty-state">Aucun médecin actif</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tous les Médecins -->
                <div id="tous-medecins" class="section">
                    <h2>Tous les Médecins (Par Catégorie)</h2>
                    <div class="filters">
                        <select id="filterCategory" class="filter-select">
                            <option value="">Toutes les catégories</option>
                        </select>
                    </div>
                    <div id="medecinsByCategory">
                        <p class="empty-state">Aucun médecin trouvé</p>
                    </div>
                </div>

                <!-- Patients -->
                <div id="patients" class="section">
                    <h2>Liste des Patients</h2>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Photo</th>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>Téléphone</th>
                                    <th>Date Inscription</th>
                                    <th>Consultations</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="patientTable">
                                <tr><td colspan="7" class="empty-state">Aucun patient</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Ajouter Médecin -->
                <div id="ajouter-medecin" class="section">
                    <h2>Ajouter un Médecin sur la Page d'Accueil</h2>
                    <form class="form-container" id="addMedecinForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Nom Complet *</label>
                                <input type="text" name="nom" required>
                            </div>
                            <div class="form-group">
                                <label>Email *</label>
                                <input type="email" name="email" required>
                            </div>
                            <div class="form-group">
                                <label>Téléphone *</label>
                                <input type="tel" name="telephone" required>
                            </div>
                            <div class="form-group">
                                <label>Spécialité *</label>
                                <select name="specialite" required>
                                    <option value="">Sélectionner une spécialité</option>
                                    <option value="Cardiologie">Cardiologie</option>
                                    <option value="Pédiatrie">Pédiatrie</option>
                                    <option value="Dermatologie">Dermatologie</option>
                                    <option value="Neurologie">Neurologie</option>
                                    <option value="Orthopédie">Orthopédie</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Prix Consultation (€) *</label>
                                <input type="number" name="prix" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label>Photo de Profil</label>
                                <input type="file" name="photo" accept="image/*">
                            </div>
                            <div class="form-group full-width">
                                <label>Bio</label>
                                <textarea name="bio" rows="4"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Afficher sur Page d'Accueil</label>
                                <input type="checkbox" name="featured" class="checkbox">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Ajouter Médecin</button>
                    </form>
                </div>

               <!-- Section Annonces -->
                <div id="annonces" class="section">
                    <div class="section-header">
                        <h2><i class="fas fa-bullhorn"></i> Gérer les Annonces de la Page d'Accueil</h2>
                    </div>

                    <!-- Formulaire d'ajout -->
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Ajouter une nouvelle annonce</h5>
                        </div>
                        <div class="card-body">
                            <form id="addAnnonceForm" enctype="multipart/form-data">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="form-group mb-3">
                                            <label for="titre" class="form-label">Titre *</label>
                                            <input type="text" id="titre" name="titre" class="form-control" required 
                                                placeholder="Titre de l'annonce">
                                        </div>

                                        <div class="form-group mb-3">
                                            <label for="contenu" class="form-label">Contenu *</label>
                                            <textarea id="contenu" name="contenu" class="form-control" rows="4" required 
                                                    placeholder="Contenu détaillé de l'annonce"></textarea>
                                        </div>

                                        <div class="form-group mb-3">
                                            <label for="description_courte" class="form-label">Description courte</label>
                                            <textarea id="description_courte" name="description_courte" class="form-control" rows="2" 
                                                    placeholder="Résumé (optionnel)"></textarea>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-4">
                                        <div class="form-group mb-3">
                                            <label for="categorie" class="form-label">Catégorie</label>
                                            <select id="categorie" name="categorie" class="form-control">
                                                <option value="">Sélectionner une catégorie</option>
                                                <option value="promotion">Promotion</option>
                                                <option value="info">Information</option>
                                                <option value="urgence">Urgence</option>
                                                <option value="evenement">Événement</option>
                                            </select>
                                        </div>

                                        <div class="form-group mb-3">
                                            <label for="priorite" class="form-label">Priorité</label>
                                            <select id="priorite" name="priorite" class="form-control">
                                                <option value="0">Normale</option>
                                                <option value="1">Haute</option>
                                                <option value="2">Urgente</option>
                                            </select>
                                        </div>

                                        <div class="form-group mb-3">
                                            <label for="image" class="form-label">Image</label>
                                            <input type="file" id="image" name="image" class="form-control" accept="image/*">
                                            <small class="text-muted">Formats acceptés: JPG, PNG, GIF (max 2Mo)</small>
                                        </div>

                                        <div class="form-group mb-3">
                                            <label for="date_expiration" class="form-label">Date d'expiration</label>
                                            <input type="date" id="date_expiration" name="date_expiration" class="form-control">
                                        </div>
                                    </div>
                                </div>

                                <!-- Section Lien (optionnel) -->
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label for="lien_cible" class="form-label">Lien de redirection (optionnel)</label>
                                            <input type="url" id="lien_cible" name="lien_cible" class="form-control" 
                                                placeholder="https://...">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label for="lien_texte" class="form-label">Texte du lien</label>
                                            <input type="text" id="lien_texte" name="lien_texte" class="form-control" 
                                                placeholder="En savoir plus">
                                        </div>
                                    </div>
                                </div>

                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-plus-circle"></i> Ajouter l'annonce
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Liste des annonces -->
                    <div class="card">
                        <div class="card-header bg-secondary text-white">
                            <h5 class="mb-0">Annonces actives</h5>
                        </div>
                        <div class="card-body">
                            <div id="annoncesList" class="table-responsive">
                                <!-- Les annonces seront chargées ici -->
                                <div class="text-center p-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Chargement...</span>
                                    </div>
                                    <p class="mt-2">Chargement des annonces...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
               <!-- Section Statistiques -->
                <div id="statistiques" class="section">
                    <div class="section-header">
                        <h2><i class="fas fa-chart-line"></i> Statistiques et Revenus</h2>
                    </div>

                    <!-- Filtres -->
                    <div class="stats-filters">
                        <div class="filter-group">
                            <select class="filter-select" id="statsPeriod">
                                <option value="today">Aujourd'hui</option>
                                <option value="week">Cette semaine</option>
                                <option value="month" selected>Ce mois</option>
                                <option value="year">Cette année</option>
                            </select>
                            <button class="btn btn-primary btn-small" onclick="refreshStats()">
                                <i class="fas fa-sync-alt"></i> Actualiser
                            </button>
                        </div>
                    </div>

                    <!-- Cartes de statistiques principales -->
                    <div class="stats-cards-grid">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">Consultations</span>
                                <span class="stat-value" id="totalConsultations">0</span>
                                <span class="stat-trend positive">
                                    <i class="fas fa-arrow-up"></i> +12%
                                </span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">Revenus Totaux</span>
                                <span class="stat-value" id="totalRevenue">0 FCFA</span>
                                <span class="stat-trend positive">
                                    <i class="fas fa-arrow-up"></i> +8%
                                </span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #5ea9dd 0%, #2c6e9c 100%);">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">Revenus du Mois</span>
                                <span class="stat-value" id="monthRevenue">0 FCFA</span>
                                <span class="stat-trend negative">
                                    <i class="fas fa-arrow-down"></i> -3%
                                </span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">Moyenne/Jour</span>
                                <span class="stat-value" id="avgDaily">0 FCFA</span>
                                <span class="stat-trend neutral">
                                    <i class="fas fa-minus"></i> Stable
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Graphiques et tableaux -->
                    <div class="stats-grid">
                        <!-- Revenus par Médecin -->
                        <div class="stats-card">
                            <div class="stats-card-header">
                                <h3><i class="fas fa-user-md"></i> Revenus par Médecin</h3>
                                <div class="card-actions">
                                    <button class="btn-icon" onclick="exportToExcel('doctors')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="stats-card-body">
                                <div class="table-responsive">
                                    <table class="stats-table">
                                        <thead>
                                            <tr>
                                                <th>Médecin</th>
                                                <th>Spécialité</th>
                                                <th>Consultations</th>
                                                <th>Revenu</th>
                                                <th>Performance</th>
                                            </tr>
                                        </thead>
                                        <tbody id="revenueByDoctorsBody">
                                            <!-- Les données seront insérées ici -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Revenus par Catégorie -->
                        <div class="stats-card">
                            <div class="stats-card-header">
                                <h3><i class="fas fa-chart-bar"></i> Revenus par Catégorie</h3>
                                <div class="card-actions">
                                    <button class="btn-icon" onclick="exportToExcel('categories')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="stats-card-body">
                                <div class="category-stats" id="revenueByCategoryBody">
                                    <!-- Les données seront insérées ici -->
                                </div>
                            </div>
                        </div>

                        <!-- Évolution des consultations -->
                        <div class="stats-card full-width">
                            <div class="stats-card-header">
                                <h3><i class="fas fa-chart-line"></i> Évolution des Consultations</h3>
                                <div class="card-actions">
                                    <select class="chart-period" id="chartPeriod">
                                        <option value="7">7 derniers jours</option>
                                        <option value="30" selected>30 derniers jours</option>
                                        <option value="90">3 derniers mois</option>
                                    </select>
                                </div>
                            </div>
                            <div class="stats-card-body">
                                <canvas id="consultationsChart" style="height: 300px;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Messagerie -->
                <div id="messagerie" class="section">
                    <h2>Messagerie</h2>
                    <div class="messaging-container">
                        <div class="contacts-list" id="contactsList">
                            <p class="empty-state">Aucun message</p>
                        </div>
                        <div class="chat-panel">
                            <div class="chat-header">
                                <h3 id="chatWith">Sélectionner un contact</h3>
                            </div>
                            <div class="chat-messages" id="chatMessages">
                                <p class="empty-state">Aucun message à afficher</p>
                            </div>
                            <div class="chat-input-area">
                                <input type="text" id="messageInput" placeholder="Votre message...">
                                <button id="sendMessageBtn" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat IA -->
                <div id="chat-ia" class="section">
                    <h2>Assistant IA</h2>
                    <div class="chat-ia-container">
                        <div class="chat-history" id="chatHistory">
                            <div class="system-message">
                                <p>Bienvenue ! Je suis votre assistant IA. Comment puis-je vous aider ?</p>
                            </div>
                        </div>
                        <div class="ia-input-area">
                            <input type="text" id="iaInput" placeholder="Posez votre question...">
                            <button id="sendIaBtn" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Paramètres -->
                <div id="parametres" class="section">
                    <h2>Paramètres</h2>
                    <div class="settings-container">
                        <h3>Profil Administrateur</h3>
                        <form class="form-container" id="settingsForm">
                            <div class="profile-section">
                                <div class="profile-photo-upload">
                                    <img id="settingsAdminPhoto" src="https://via.placeholder.com/150" alt="Admin">
                                    <label for="photoUpload" class="upload-btn">
                                        <i class="fas fa-camera"></i> Changer la Photo
                                    </label>
                                    <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                                </div>
                                <div class="profile-info">
                                    <div class="form-group">
                                        <label>Nom Complet</label>
                                        <input type="text" id="adminFullName" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Email</label>
                                        <input type="email" id="adminEmail" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Téléphone</label>
                                        <input type="tel" id="adminPhone">
                                    </div>
                                    <button type="submit" class="btn btn-primary">Sauvegarder</button>
                                </div>
                            </div>
                        </form>

                        <hr style="margin: 40px 0;">

                        <h3>Gestion des Administrateurs</h3>
                        <p style="margin-bottom: 20px;">Nommer un médecin comme administrateur</p>
                        <form class="form-container" id="appointAdminForm">
                            <div class="form-group">
                                <label>Sélectionner un Médecin</label>
                                <select id="selectMedecinAdmin" required>
                                    <option value="">Choisir un médecin</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Nommer Admin</button>
                        </form>

                        <div class="admins-list" id="adminsList" style="margin-top: 30px;">
                            <h4>Administrateurs Actuels</h4>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Nom</th>
                                        <th>Email</th>
                                        <th>Date Nomination</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="adminsTable">
                                    <tr><td colspan="4" class="empty-state">Aucun administrateur</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal pour approuver/rejeter médecin -->
    <div id="medecinModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3 id="modalTitle">Détails du Médecin</h3>
            <div id="medecinDetails" class="details-grid"></div>
            <div class="form-group" style="margin-top: 16px;">
                <label for="rejectReasonInput">Motif du refus (optionnel)</label>
                <textarea id="rejectReasonInput" rows="3" placeholder="Précisez le motif si nécessaire"></textarea>
            </div>
            <div class="modal-actions">
                <button id="approveMedecinBtn" class="btn btn-success">Approuver</button>
                <button id="rejectMedecinBtn" class="btn btn-danger">Rejeter</button>
            </div>
        </div>
    </div>

    <!-- Modal pour supprimer médecin -->
    <div id="deleteModal" class="modal">
        <div class="modal-content confirm-modal">
            <span class="close-modal">&times;</span>
            <h3>Confirmation de Suppression</h3>
            <p>Êtes-vous sûr de vouloir supprimer ce médecin ?</p>
            <div class="modal-actions">
                <button id="confirmDeleteBtn" class="btn btn-danger">Supprimer</button>
                <button class="btn btn-secondary close-modal">Annuler</button>
            </div>
        </div>
    </div>

    <script src="/static/js/admin.js"></script>
    <!-- Chart.js pour les graphiques -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</body>
</html>
